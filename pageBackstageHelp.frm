VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.2#0"; "MSCOMCTL.OCX"
Object = "{555E8FCC-830E-45CC-AF00-A012D5AE7451}#17.2#0"; "Codejock.CommandBars.v17.2.0.ocx"
Begin VB.Form pageBackstageHelp 
   BackColor       =   &H00FFFFFF&
   BorderStyle     =   0  'None
   Caption         =   "Version 17.2.0"
   ClientHeight    =   9000
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   17115
   LinkTopic       =   "Form1"
   ScaleHeight     =   600
   ScaleMode       =   3  'Pixel
   ScaleWidth      =   1141
   ShowInTaskbar   =   0   'False
   StartUpPosition =   3  'Windows Default
   Begin XtremeCommandBars.BackstageButton btnAcciones 
      Height          =   1095
      Index           =   3
      Left            =   360
      TabIndex        =   2
      Top             =   5760
      Width           =   5055
      _Version        =   1114114
      _ExtentX        =   8916
      _ExtentY        =   1931
      _StockProps     =   79
      Caption         =   $"pageBackstageHelp.frx":0000
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Segoe UI"
         Size            =   9
         Charset         =   204
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      TextAlignment   =   4
      EnableMarkup    =   -1  'True
      ImageAlignment  =   0
      IconWidth       =   64
      Icon            =   "pageBackstageHelp.frx":00AC
   End
   Begin XtremeCommandBars.BackstageButton btnAcciones 
      Height          =   1095
      Index           =   1
      Left            =   360
      TabIndex        =   3
      Top             =   2280
      Width           =   5055
      _Version        =   1114114
      _ExtentX        =   8916
      _ExtentY        =   1931
      _StockProps     =   79
      Caption         =   $"pageBackstageHelp.frx":4116
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Segoe UI"
         Size            =   9
         Charset         =   204
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      TextAlignment   =   4
      EnableMarkup    =   -1  'True
      ImageAlignment  =   0
      IconWidth       =   64
      Icon            =   "pageBackstageHelp.frx":41DE
   End
   Begin XtremeCommandBars.BackstageButton btnAcciones 
      Height          =   1095
      Index           =   2
      Left            =   360
      TabIndex        =   4
      Top             =   3600
      Width           =   5055
      _Version        =   1114114
      _ExtentX        =   8916
      _ExtentY        =   1931
      _StockProps     =   79
      Caption         =   $"pageBackstageHelp.frx":8248
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Segoe UI"
         Size            =   9
         Charset         =   204
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      TextAlignment   =   4
      EnableMarkup    =   -1  'True
      ImageAlignment  =   0
      IconWidth       =   64
      Icon            =   "pageBackstageHelp.frx":8327
   End
   Begin XtremeCommandBars.BackstageButton btnAcciones 
      Height          =   1095
      Index           =   0
      Left            =   360
      TabIndex        =   7
      Top             =   960
      Width           =   5055
      _Version        =   1114114
      _ExtentX        =   8916
      _ExtentY        =   1931
      _StockProps     =   79
      Caption         =   $"pageBackstageHelp.frx":C391
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Segoe UI"
         Size            =   9
         Charset         =   204
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      TextAlignment   =   4
      EnableMarkup    =   -1  'True
      ImageAlignment  =   0
      IconWidth       =   64
      Icon            =   "pageBackstageHelp.frx":C44A
   End
   Begin XtremeCommandBars.BackstageButton btnAcciones 
      Height          =   1095
      Index           =   4
      Left            =   360
      TabIndex        =   8
      Top             =   7080
      Width           =   5055
      _Version        =   1114114
      _ExtentX        =   8916
      _ExtentY        =   1931
      _StockProps     =   79
      Caption         =   $"pageBackstageHelp.frx":104B4
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Segoe UI"
         Size            =   9
         Charset         =   204
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      TextAlignment   =   4
      EnableMarkup    =   -1  'True
      ImageAlignment  =   0
      IconWidth       =   64
      Icon            =   "pageBackstageHelp.frx":10578
   End
   Begin XtremeCommandBars.BackstageSeparator BackstageSeparator1 
      Height          =   255
      Left            =   6360
      TabIndex        =   10
      Top             =   1320
      Width           =   10335
      _Version        =   1114114
      _ExtentX        =   18230
      _ExtentY        =   450
      _StockProps     =   2
      MarkupText      =   ""
   End
   Begin XtremeCommandBars.BackstageSeparator lblBackstageSeparator4 
      Height          =   8655
      Left            =   5880
      TabIndex        =   9
      Top             =   120
      Width           =   135
      _Version        =   1114114
      _ExtentX        =   238
      _ExtentY        =   15266
      _StockProps     =   2
      Vertical        =   -1  'True
      MarkupText      =   ""
   End
   Begin XtremeCommandBars.BackstageSeparator lblBackstageSeparator2 
      Height          =   255
      Left            =   360
      TabIndex        =   6
      Top             =   5280
      Width           =   5175
      _Version        =   1114114
      _ExtentX        =   9128
      _ExtentY        =   450
      _StockProps     =   2
      MarkupText      =   ""
   End
   Begin XtremeCommandBars.BackstageSeparator lblBackstageSeparator1 
      Height          =   255
      Left            =   360
      TabIndex        =   0
      Top             =   480
      Width           =   5175
      _Version        =   1114114
      _ExtentX        =   9128
      _ExtentY        =   450
      _StockProps     =   2
      MarkupText      =   ""
   End
   Begin VB.PictureBox tabPage 
      BackColor       =   &H00FFFFFF&
      BorderStyle     =   0  'None
      Height          =   6375
      Index           =   2
      Left            =   6240
      ScaleHeight     =   6375
      ScaleWidth      =   10575
      TabIndex        =   26
      Top             =   2160
      Visible         =   0   'False
      Width           =   10575
      Begin MSComctlLib.ListView ListView1 
         Height          =   4035
         Left            =   120
         TabIndex        =   29
         Top             =   720
         Width           =   9495
         _ExtentX        =   16748
         _ExtentY        =   7117
         View            =   2
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Verdana"
            Size            =   9.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   2540
         EndProperty
      End
      Begin VB.Label Label8 
         BackColor       =   &H00FFFFFF&
         BeginProperty Font 
            Name            =   "Segoe UI Light"
            Size            =   9.75
            Charset         =   204
            Weight          =   300
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H005B5B5B&
         Height          =   255
         Left            =   120
         TabIndex        =   28
         Top             =   4920
         Width           =   4695
      End
      Begin VB.Label Label7 
         BackColor       =   &H00FFFFFF&
         Caption         =   "Documentos de interes"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9.75
            Charset         =   204
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H005B5B5B&
         Height          =   255
         Left            =   120
         TabIndex        =   27
         Top             =   240
         Width           =   4695
      End
   End
   Begin VB.PictureBox tabPage 
      BackColor       =   &H00FFFFFF&
      BorderStyle     =   0  'None
      Height          =   6375
      Index           =   1
      Left            =   6240
      ScaleHeight     =   6375
      ScaleWidth      =   10575
      TabIndex        =   22
      Top             =   2040
      Visible         =   0   'False
      Width           =   10575
      Begin MSComctlLib.ListView ListView4 
         Height          =   5145
         Left            =   120
         TabIndex        =   25
         Top             =   720
         Width           =   10395
         _ExtentX        =   18336
         _ExtentY        =   9075
         View            =   3
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Verdana"
            Size            =   9.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   0
      End
      Begin VB.Label Label13 
         BackColor       =   &H00FFFFFF&
         Caption         =   "Usuarios conectados"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9.75
            Charset         =   204
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H005B5B5B&
         Height          =   255
         Left            =   120
         TabIndex        =   24
         Top             =   240
         Width           =   4695
      End
      Begin VB.Label Label6 
         BackColor       =   &H00FFFFFF&
         BeginProperty Font 
            Name            =   "Segoe UI Light"
            Size            =   9.75
            Charset         =   204
            Weight          =   300
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H005B5B5B&
         Height          =   255
         Left            =   120
         TabIndex        =   23
         Top             =   6120
         Width           =   4695
      End
   End
   Begin VB.PictureBox tabPage 
      BackColor       =   &H00FFFFFF&
      BorderStyle     =   0  'None
      Height          =   6375
      Index           =   0
      Left            =   6120
      ScaleHeight     =   6375
      ScaleWidth      =   10695
      TabIndex        =   11
      Top             =   1920
      Visible         =   0   'False
      Width           =   10695
      Begin MSComctlLib.ListView ListView3 
         Height          =   4905
         Left            =   240
         TabIndex        =   13
         Top             =   1065
         Width           =   10395
         _ExtentX        =   18336
         _ExtentY        =   8652
         View            =   3
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         HideColumnHeaders=   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Verdana"
            Size            =   9.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   0
      End
      Begin VB.Label Label5 
         BackColor       =   &H00FFFFFF&
         BeginProperty Font 
            Name            =   "Segoe UI Light"
            Size            =   9.75
            Charset         =   204
            Weight          =   300
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H005B5B5B&
         Height          =   255
         Left            =   120
         TabIndex        =   21
         Top             =   6120
         Width           =   4695
      End
      Begin VB.Label Label46 
         BackStyle       =   0  'Transparent
         Caption         =   "Concepto"
         Height          =   255
         Left            =   240
         TabIndex        =   19
         Top             =   720
         Width           =   2355
      End
      Begin VB.Label Label47 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "Ejercicio Actual"
         BeginProperty Font 
            Name            =   "Verdana"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   2985
         TabIndex        =   18
         Top             =   360
         Width           =   3705
      End
      Begin VB.Label Label48 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "Ejercicio Siguiente"
         BeginProperty Font 
            Name            =   "Verdana"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   6735
         TabIndex        =   17
         Top             =   360
         Width           =   3435
      End
      Begin VB.Label Label45 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "Porcentaje"
         BeginProperty Font 
            Name            =   "Verdana"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   5685
         TabIndex        =   16
         Top             =   720
         Width           =   1005
      End
      Begin VB.Label Label49 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "Porcentaje"
         BeginProperty Font 
            Name            =   "Verdana"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   9015
         TabIndex        =   15
         Top             =   720
         Width           =   1005
      End
      Begin VB.Label Label51 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "Cantidad"
         BeginProperty Font 
            Name            =   "Verdana"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   8145
         TabIndex        =   14
         Top             =   720
         Width           =   795
      End
      Begin VB.Label Label4 
         BackColor       =   &H00FFFFFF&
         Caption         =   "Informacion BBDD"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9.75
            Charset         =   204
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H005B5B5B&
         Height          =   255
         Left            =   240
         TabIndex        =   12
         Top             =   240
         Width           =   4695
      End
   End
   Begin VB.Image Image1 
      Height          =   1350
      Left            =   6240
      Picture         =   "pageBackstageHelp.frx":145E2
      Top             =   0
      Width           =   3840
   End
   Begin VB.Label Label9 
      BackColor       =   &H00FFFFFF&
      BeginProperty Font 
         Name            =   "Segoe UI Light"
         Size            =   9.75
         Charset         =   204
         Weight          =   300
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H005B5B5B&
      Height          =   255
      Left            =   6360
      TabIndex        =   30
      Top             =   1680
      Visible         =   0   'False
      Width           =   8175
   End
   Begin VB.Label Label3 
      BackColor       =   &H00FFFFFF&
      Caption         =   "Leyendo datos"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   9.75
         Charset         =   204
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H005B5B5B&
      Height          =   255
      Left            =   6360
      TabIndex        =   20
      Top             =   2760
      Visible         =   0   'False
      Width           =   2535
   End
   Begin VB.Label Label2 
      BackColor       =   &H00FFFFFF&
      Caption         =   "Base de datos"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   9.75
         Charset         =   204
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H005B5B5B&
      Height          =   255
      Left            =   360
      TabIndex        =   5
      Top             =   5040
      Width           =   2535
   End
   Begin VB.Label Label1 
      BackColor       =   &H00FFFFFF&
      Caption         =   "Informacion"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   9.75
         Charset         =   204
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H005B5B5B&
      Height          =   255
      Left            =   360
      TabIndex        =   1
      Top             =   240
      Width           =   2535
   End
End
Attribute VB_Name = "pageBackstageHelp"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

Private Sub Form_Load()
    Label9.Caption = vEmpresa.nomempre
End Sub

Private Sub Form_Resize()
On Error Resume Next
    lblBackstageSeparator4.Height = Me.ScaleHeight
End Sub


Private Sub btnAcciones_Click(Index As Integer)
    Screen.MousePointer = vbHourglass
    
    On Error GoTo ebtnAcciones_Click
    
    tabPage(0).Visible = False
    tabPage(1).Visible = False
    tabPage(2).Visible = False
    Label9.Visible = False
    Select Case Index
       
        Case 2
            'CAlendario del contribuyente
            LanzaVisorMimeDocumento Me.hwnd, "http://www.agenciatributaria.es/AEAT.internet/Bibl_virtual/folletos/calendario_contribuyente.shtml"
        Case 1 ' documentos
            
            Label3.Visible = True
            Label3.Refresh
            'Cargadocumentos
            tabPage(2).Visible = True
            Label3.Visible = False
        Case 0 ' ayuda
            LanzaVisorMimeDocumento Me.hwnd, DireccionAyuda & "/Ariconta-6.html"  ' "http://www.ariadnasw.com/clientes/"
        
        Case 10 ' arimailges.exe
            'Dim Lanza As String
           ' Dim Aux As String
           '
           '
           ' Lanza = vParam.MailSoporte & "||"
           '
           ' 'Aqui pondremos lo del texto del BODY
           ' Lanza = Lanza & "|"
           ' 'Envio o mostrar
           ' Lanza = Lanza & "0"   '0. Display   1.  send
           '
           ' 'Campos reservados para el futuro
           ' Lanza = Lanza & "||||"
           '
           ' 'El/los adjuntos
           ' Lanza = Lanza & "|"
           '
           ' Aux = App.Path & "\ARIMAILGES.EXE" & " " & Lanza  '& vParamAplic.ExeEnvioMail & " " & Lanza
           ' Shell Aux, vbNormalFocus
       '
        Case 3 ' Informacion de la base de datos
            Label3.Visible = True
            Label3.Refresh
            If CargarInformacionBBDD Then
                CargaInformeBBDD
                Label9.Visible = True
                tabPage(0).Visible = True
            End If
            Label3.Visible = False
            
        Case 4 'Usuarios activos
            Label3.Visible = True
            Label3.Refresh
            CargaShowProcessList
            Label9.Visible = True
            tabPage(1).Visible = True
            Label3.Visible = False
 
    End Select
    
    
ebtnAcciones_Click:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Screen.MousePointer = vbDefault
End Sub


Private Function CargarInformacionBBDD() As String
Dim Sql As String
Dim Sql2 As String
Dim CadValues As String
Dim NroRegistros As Long
Dim NroRegistrosSig As Long
Dim NroRegistrosTot As Long
Dim NroRegistrosTotSig As Long
Dim FecIniSig As Date
Dim FecFinSig As Date
Dim Porcen1 As Currency
Dim Porcen2 As Currency
Dim RS As ADODB.Recordset

    On Error GoTo eCargarInformacionBBDD
    
    CargarInformacionBBDD = False
    
    
    'FAltari ver si ponemos ubna tabla aqui
    Sql = "delete from ariconta" & vParam.Numconta & ".tmpinfbbdd where codusu = " & vUsu.Codigo
    Conn.Execute Sql
    
    'FecIniSig = DateAdd("yyyy", 1, vParam.fechaini)
    'FecFinSig = DateAdd("yyyy", 1, vParam.fechafin)
    FecIniSig = DateAdd("yyyy", 1, Now)
    FecFinSig = DateAdd("yyyy", 1, Now)
    
    
    
    Sql2 = "insert into ariconta" & vParam.Numconta & ".tmpinfbbdd (codusu,posicion,concepto,nactual,poractual,nsiguiente,porsiguiente) values "
    
    
    
    'apuntes
    'Sql = "select count(*) from hlinapu where fechaent between " & DBSet(vParam.fechaini, "F") & " and " & DBSet(vParam.fechafin, "F")
    'NroRegistros = DevuelveValor(Sql)
    'Sql = "select count(*) from hlinapu where fechaent between " & DBSet(FecIniSig, "F") & " and " & DBSet(FecFinSig, "F")
    'NroRegistrosSig = DevuelveValor(Sql)
    
    'CadValues = "(" & vUsu.Codigo & ",2,'Apuntes'," & DBSet(NroRegistros, "N") & ",0," & DBSet(NroRegistrosSig, "N") & ",0)"
    'Conn.Execute Sql2 & CadValues
    
    
    
    
    
    CargarInformacionBBDD = True
    Exit Function


eCargarInformacionBBDD:
    MuestraError Err.Number, "Cargar Temporal de BBDD", Err.Description
End Function






Private Sub CargaInformeBBDD()
Dim IT As ListItem
Dim TotalArray  As Long
    On Error GoTo ECargaInformeBBDD
    
    Set RS = New ADODB.Recordset
    
    Sql = "select * from ariconta" & vParam.Numconta & ".tmpinfbbdd where codusu = " & vUsu.Codigo & " order by posicion "
    
    Set RS = New ADODB.Recordset
    RS.Open Sql, Conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    ListView3.ListItems.Clear
    ListView3.ColumnHeaders.Clear
    ListView3.ColumnHeaders.Add , , "CONCEPTO", 3500.0631
    ListView3.ColumnHeaders.Add , , "count ACTUAL", 2250.2522, 1
    ListView3.ColumnHeaders.Add , , "porcen ACTUAL", 1000.2522, 1
    ListView3.ColumnHeaders.Add , , "count siguiente", 2250.2522, 1
    ListView3.ColumnHeaders.Add , , "porcen siguiente", 1000.2522, 1
    
    
    
    
    TotalArray = 0
    While Not RS.EOF
        Set IT = ListView3.ListItems.Add
        
        IT.Text = UCase(DBLet(RS!Concepto, "T"))
        
        If DBLet(RS!posicion, "N") > 2 Then
            IT.SubItems(1) = Format(DBLet(RS!nactual, "N"), "###,###,###,##0")
            IT.SubItems(2) = Format(DBLet(RS!Poractual, "N"), "##0.00") & "%"
            IT.SubItems(3) = Format(DBLet(RS!nsiguiente, "N"), "###,###,###,##0")
            IT.SubItems(4) = Format(DBLet(RS!Porsiguiente, "N"), "##0.00") & "%"
        Else
            IT.SubItems(1) = Format(DBLet(RS!nactual, "N"), "###,###,###,##0")
            IT.SubItems(3) = Format(DBLet(RS!nsiguiente, "N"), "###,###,###,##0")
        End If
        
        RS.MoveNext
    Wend
    
    RS.Close
    
    Label5.Caption = Format(Now, "dd/mm/yyyy hh:nn:ss")
    Exit Sub
    
ECargaInformeBBDD:
    MuestraError Err.Number, Err.Description
    Set RS = Nothing
End Sub




Private Sub CargaShowProcessList()
Dim IT As ListItem
Dim TotalArray  As Long
Dim SERVER As String
Dim EquipoConBD As Boolean
Dim Cad As String
Dim Equipo As String

    On Error GoTo ECargaShowProcessList
    
    Set RS = New ADODB.Recordset
    
    ListView4.ListItems.Clear
    ListView4.ColumnHeaders.Clear
    
    ListView4.ColumnHeaders.Add , , "ID", 1500.0631
    ListView4.ColumnHeaders.Add , , "User", 2250.2522, 1
    ListView4.ColumnHeaders.Add , , "Host", 3000.2522, 1
    ListView4.ColumnHeaders.Add , , "Tiempo espera", 3050.2522, 1
    
    
    Set RS = New ADODB.Recordset
    
    SERVER = Mid(Conn.ConnectionString, InStr(LCase(Conn.ConnectionString), "server=") + 7)
    SERVER = Mid(SERVER, 1, InStr(1, SERVER, ";"))
    
    EquipoConBD = (UCase(vUsu.PC) = UCase(SERVER)) Or (LCase(SERVER) = "localhost")
    
    Cad = "show full processlist"
    RS.Open Cad, Conn, adOpenKeyset, adLockOptimistic, adCmdText
    Cad = ""
    While Not RS.EOF
        If Not IsNull(RS.Fields(3)) Then
            If InStr(1, RS.Fields(3), "arigestion") <> 0 Then
                If UCase(RS.Fields(3)) = UCase(vUsu.CadenaConexion) Then
                    Equipo = RS.Fields(2)
                    'Primero quitamos los dos puntos del puerto
                    NumRegElim = InStr(1, Equipo, ":")
                    If NumRegElim > 0 Then Equipo = Mid(Equipo, 1, NumRegElim - 1)
                    
                    'El punto del dominio
                    NumRegElim = InStr(1, Equipo, ".")
                    If NumRegElim > 0 Then Equipo = Mid(Equipo, 1, NumRegElim - 1)
                    
                    Equipo = UCase(Equipo)
                    
                    
                    Set IT = ListView4.ListItems.Add
                    
                    IT.Text = RS.Fields(0)
                    IT.SubItems(1) = RS.Fields(1)
                    IT.SubItems(2) = Equipo
                    
                    'tiempo de espera
                    Dim FechaAnt As Date
                    FechaAnt = DateAdd("s", RS.Fields(5), Now)
                    IT.SubItems(3) = Format((Now - FechaAnt), "hh:mm:ss")
                End If
            End If
        End If
        
        'Siguiente
        RS.MoveNext
    Wend
    NumRegElim = 0
    RS.Close
    Set RS = Nothing
    Label6.Caption = Format(Now, "dd/mm/yyyy hh:nn:ss")
    
    
    Exit Sub
    
ECargaShowProcessList:
    MuestraError Err.Number, Err.Description
    Set RS = Nothing
End Sub


Private Sub Cargadocumentos()
Dim RN As ADODB.Recordset
Dim Cad As String
Dim IT As ListItem

    On Error GoTo eCargadocumentos

    'Set Me.ListView1.SmallIcons = frmppal.ImageList1 'frmPpal.ImageListDocumentos

    Cad = "select iddocumento,nombrearchi from usuarios.wfichdocs WHERE aplicacion='ariconta' order by orden "
    Set RN = New ADODB.Recordset
    RN.Open Cad, Conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not RN.EOF
        ListView1.ListItems.Add , "D" & Format(RN!iddocumento, "00000"), RN!nombrearchi, , 7   '1:PDF
       
        RN.MoveNext
    Wend
    RN.Close
    If ListView1.ListItems.Count = 0 Then
        Label8.Caption = "No hay documentacion disponible"
        Label8.Visible = True
    Else
        Label8.Visible = False
    End If
    
    Exit Sub
eCargadocumentos:
    MuestraError Err.Number
End Sub

Private Sub ListView1_DblClick()
Dim Abrir As Boolean

    If Me.ListView1.SelectedItem Is Nothing Then Exit Sub
    
    Abrir = False 'antes \ImgFicFT
    If Dir(App.Path & "\temp\" & ListView1.SelectedItem & ".pdf", vbArchive) = "" Then
        Adodc1.ConnectionString = Conn
        Adodc1.RecordSource = "Select * from usuarios.wfichdocs where idDocumento=" & Mid(ListView1.SelectedItem.Key, 2)
        Adodc1.Refresh

        If LeerBinary(Adodc1.Recordset!Campo, App.Path & "\temp\" & ListView1.SelectedItem.Text & ".pdf") Then Abrir = True
    Else
        Abrir = True
        
    End If
    
    If Abrir Then LanzaVisorMimeDocumento Me.hwnd, App.Path & "\temp\" & ListView1.SelectedItem & ".pdf"
        
End Sub

